;(function($){var i=0,got=-1,len=document.getElementsByTagName('script').length;while(i<=len&&got==-1){var js_url=document.getElementsByTagName('script')[i].src,got=js_url.indexOf('article.js');i++;};var edit_mode='1',ajax_php_url=js_url.replace('/article.js','/../includes/comments-ajax.php'),wp_url=js_url.substr(0,js_url.indexOf('wp-content')),pic_sb=wp_url+'wp-admin/images/wpspin_dark.gif',pic_no=wp_url+'wp-admin/images/no.png',pic_ys=wp_url+'wp-admin/images/yes.png',txt1='<div id="loading">正在提交, 请稍候...</div>',txt2='<div id="error">错误...</div>',txt3='">提交成功',cancel_edit='取消编辑',edit,num=1,comm_array=[];comm_array.push('');$(document).ready(function($){$("#toggle-comment-author-info").live('click',function(e){if($('#comment-author-info').height()==0){$(this).parent().next().animate({height:"120px"},"slow");}else{$(this).parent().next().animate({height:"0px"},"slow","swing");}});$("#trackback_switch").live('click',function(e){$("#comment_switch").removeClass("comment_switch_active");$(this).addClass("comment_switch_active");$("#comment-body").animate({opacity:"hide"},0);$("#trackback-body").animate({opacity:"show"},500);return false;});$("#comment_switch").live('click',function(e){$("#trackback_switch").removeClass("comment_switch_active");$(this).addClass("comment_switch_active");$("#trackback-body").animate({opacity:"hide"},0);$("#comment-body").animate({opacity:"show"},500);return false;});$("#comment").live('click',function(){$("#toolBar").animate({opacity:"show"},300);return false});$("#edit_profile").toggle(function(){$("#guest_info").slideDown(200);$("#welcome_msg").slideUp(200);$("#edit_profile").html(" (\u6539\u597d\u4e86\u5427~)");return false;},function(){$("#guest_info").slideUp(200);$("#welcome_msg").slideDown(200);$("#edit_profile").html(" (\u518d\u6539\u4e00\u6b21\uff1f)");return false;})
    $(".comment-reply-link").live('click',function(e){var author='"#'+$(this).parent().parent().attr("id")+'"',comment=$(this).parent().parent().parent().find(".comment_author:first").text();$("#comment").attr("value","<a href="+author+">@"+comment+" </a>,").focus();});$(".comment-reply-quote").live('click',function(e){var a='"#'+$(this).parent().parent().attr("id")+'"',g=$(this).parent().parent().parent().find(".comment_author:first").text(),k=$(this).parent().parent().parent().find(".comment-body:first").html().replace(/\t/g,"");$("#comment").attr("value","引用自<a href="+a+">"+g+"</a>:<blockquote>"+k+"</blockquote>\n<a href="+a+">@"+g+" </a>").focus();});$(".comment-body").live('dblclick',function(){$(this).parent().find(".comment-reply-link").click();return false;});$('#comment-smiley').click(function(){$('#smileys').toggle();});$('#smileys a').live('click',function(){$(this).parent().hide();});if($('#smileys').html()==0){var sresponse='#smileys';$('#comment-smiley').click(function(){$.ajax({type:"POST",data:"action=smiley_ajax_action",success:function(data)
    {$(sresponse).html(data);}});return false;});};$comments=$('#comments-title');$cancel=$('#cancel-comment-reply-link');cancel_text=$cancel.text();$submit=$('#commentform #submit_comment');$submit.attr('disabled',false);$('#comment').after(txt1+txt2);$('#loading').hide();$('#error').hide();$body=(window.opera)?(document.compatMode=="CSS1Compat"?$('html'):$('body')):$('html,body');$('#commentform').submit(function(){$('#loading').slideDown();$submit.attr('disabled',true).fadeTo('slow',0.5);if(edit)$('#comment').after('<input type="text" name="edit_id" id="edit_id" value="'+edit+'" style="display:none;" />');$.ajax({url:ajax_php_url,data:$(this).serialize(),type:$(this).attr('method'),error:function(request){$('#loading').slideUp();$('#error').slideDown().html('<img src="'+pic_no+'" style="vertical-align:middle;" alt=""/> '+request.responseText);setTimeout(function(){$submit.attr('disabled',false).fadeTo('slow',1);$('#error').slideUp();},3000);},success:function(data){$('#loading').hide();comm_array.push($('#comment').val());$('textarea').each(function(){this.value='';});var t=addComment,cancel=t.I('cancel-comment-reply-link'),temp=t.I('wp-temp-form-div'),respond=t.I(t.respondId),post=t.I('comment_post_ID').value,parent=t.I('comment_parent').value;if(!edit&&$comments.length){n=parseInt($comments.text().match(/\d+/));$comments.text($comments.text().replace(n,n+1));};new_htm='" id="new_comm_'+num+'"></';new_htm=(parent=='0')?('\n<ol style="clear:both;" class="commentlist'+new_htm+'ol>'):('\n<ul class="children'+new_htm+'ul>');ok_htm='\n<span id="success_'+num+txt3;ok_htm+='</span>\n';$('#respond').before(new_htm);$('#new_comm_'+num).hide().append(data);$('#new_comm_'+num+' li').append(ok_htm);$('#new_comm_'+num).fadeIn(4000);$body.animate({scrollTop:$('#new_comm_'+num).offset().top-200},900);countdown();num++;cancel.style.display='none';cancel.onclick=null;t.I('comment_parent').value='0';if(temp&&respond){temp.parentNode.insertBefore(respond,temp);temp.parentNode.removeChild(temp);};}});return false;});$('#comment_pager a').live('click',function(e){e.preventDefault();var wpurl=$(this).attr("href").split(/(\?|&)action=AjaxCommentsPage.*$/)[0];var commentPage=1;if(/comment-page-/i.test(wpurl)){commentPage=wpurl.split(/comment-page-/i)[1].split(/(\/|#|&).*$/)[0];}else if(/cpage=/i.test(wpurl)){commentPage=wpurl.split(/cpage=/)[1].split(/(\/|#|&).*$/)[0];};var postId=$('#comment-body').data('comid');var url=wpurl.split(/#.*$/)[0];url+=/\?/i.test(wpurl)?'&':'?';url+='action=AjaxCommentsPage&post='+postId+'&page='+commentPage;$.ajax({url:url,type:'POST',beforeSend:function(){var C=0.7;$('#thecomments,#comment_pager').css({opacity:C,MozOpacity:C,KhtmlOpacity:C,filter:'alpha(opacity='+C*100+')'});var loading='Loading';$('#comment_pager').html(loading);var t=addComment,cancel=t.I('cancel-comment-reply-link'),temp=t.I('wp-temp-form-div'),respond=t.I(t.respondId),post=t.I('comment_post_ID').value,parent=t.I('comment_parent').value;cancel.style.display='none';cancel.onclick=null;t.I('comment_parent').value='0';if(temp&&respond){temp.parentNode.insertBefore(respond,temp);temp.parentNode.removeChild(temp);}},error:function(request){alert(request.responseText);},success:function(data){var responses=data.split('<!---AJAX-COMMENT-PAGE-->');$('#thecomments').html(responses[0]);$('#comment_pager').html(responses[1]);var C=1;$('#thecomments,#comment_pager').css({opacity:C,MozOpacity:C,KhtmlOpacity:C,filter:'alpha(opacity='+C*100+')'});$body.animate({scrollTop:$('#comment_header').offset().top},1000);$('#cmploading').remove();document.body.style.cursor='auto';single_js();}});return false;});addComment={moveForm:function(commId,parentId,respondId,postId,num){var t=this,div,comm=t.I(commId),respond=t.I(respondId),cancel=t.I('cancel-comment-reply-link'),parent=t.I('comment_parent'),post=t.I('comment_post_ID');if(edit)exit_prev_edit();num?(t.I('comment').value=comm_array[num],edit=t.I('new_comm_'+num).innerHTML.match(/(comment-)(\d+)/)[2],$new_sucs=$('#success_'+num),$new_sucs.hide(),$new_comm=$('#new_comm_'+num),$new_comm.hide(),$cancel.text(cancel_edit)):$cancel.text(cancel_text);t.respondId=respondId;postId=postId||false;if(!t.I('wp-temp-form-div')){div=document.createElement('div');div.id='wp-temp-form-div';div.style.display='none';respond.parentNode.insertBefore(div,respond);}!comm?(temp=t.I('wp-temp-form-div'),t.I('comment_parent').value='0',temp.parentNode.insertBefore(respond,temp),temp.parentNode.removeChild(temp)):comm.parentNode.insertBefore(respond,comm.nextSibling);$body.animate({scrollTop:$('#respond').offset().top-180},400);if(post&&postId)post.value=postId;parent.value=parentId;cancel.style.display='';cancel.onclick=function(){if(edit)exit_prev_edit();var t=addComment,temp=t.I('wp-temp-form-div'),respond=t.I(t.respondId);t.I('comment_parent').value='0';if(temp&&respond){temp.parentNode.insertBefore(respond,temp);temp.parentNode.removeChild(temp);}
        this.style.display='none';this.onclick=null;return false;};try{t.I('comment').focus();}catch(e){}
        return false},I:function(e){return document.getElementById(e);}};function exit_prev_edit(){$new_comm.show();$new_sucs.show();$('textarea').each(function(){this.value='';});edit='';};var wait=15,submit_val=$submit.val();function countdown(){if(wait>0){$submit.val(wait);wait--;setTimeout(countdown,1000);}else{$submit.val(submit_val).attr('disabled',false).fadeTo('slow',1);wait=15;};};function isie6(){if($.browser.msie){if($.browser.version=="6.0")return true;}return false;};function addEditor(a,b,c){if(document.selection){a.focus();sel=document.selection.createRange();c?sel.text=b+sel.text+c:sel.text=b;a.focus();}else if(a.selectionStart||a.selectionStart=='0'){var d=a.selectionStart;var e=a.selectionEnd;var f=e;c?a.value=a.value.substring(0,d)+b+a.value.substring(d,e)+c+a.value.substring(e,a.value.length):a.value=a.value.substring(0,d)+b+a.value.substring(e,a.value.length);c?f+=b.length+c.length:f+=b.length-e+d;if(d==e&&c)f-=c.length;a.focus();a.selectionStart=f;a.selectionEnd=f;}else{a.value+=b+c;a.focus();};};var g=document.getElementById('comment')||0;var h={strong:function(){addEditor(g,'<strong>','</strong>');},em:function(){addEditor(g,'<em>','</em>');},del:function(){addEditor(g,'<del>','</del>');},underline:function(){addEditor(g,'<u>','</u>');},code:function(){addEditor(g,'<code>','</code>');},empty:function(){g.value="";g.focus();},ahref:function(){var a=prompt('链接地址','http://');if(a){addEditor(g,'<a target="_blank" href="'+a+'" rel="external">连接地址','</a>');}},img:function(){var a=prompt('请输入图片地址','http://');if(a){addEditor(g,'<img src="'+a+'" alt="" />','');}}};window['SIMPALED']={};window['SIMPALED']['Editor']=h;var $win=$(window),$oDirewarp=$('#article-index'),$oDire=$('#article-index dt,#article-index dd'),navTop=$oDire.length&&$('.entry').offset().top,isFixed=0;processScroll();$win.on('scroll',processScroll);function processScroll(){var i,scrollTop=$win.scrollTop(),cliTop=$win.height(),isIE=!!window.ActiveXObject,isIE6=isIE&&!window.XMLHttpRequest,anchors=$(".entry section h2,.entry section h3"),anchorMd=[];for(var i=0,len=anchors.length;i<len;i++){anchorMd.push($(anchors[i]));};for(var i=0;i<len;i++){var mdHeight=anchorMd[i].offset().top;if(mdHeight<=scrollTop+cliTop/2){var j=i;$oDire.removeClass('on');$oDire.eq(j).addClass('on');};};if(scrollTop>=navTop&&!isFixed){isFixed=1;$oDirewarp.addClass('articlenav-fixed');}else if(scrollTop<=navTop&&isFixed){isFixed=0;$oDirewarp.removeClass('articlenav-fixed');};if(isIE6){$oDirewarp.css({'position':'absolute','top':scrollTop-cliTop/2+80});};};$oDirewarp.hover(function(){$(this).animate({opacity:"1"},300);},function(){$(this).animate({opacity:".2"},300);});});})(jQuery);function grin(tag){tag=' '+tag+' ';myField=document.getElementById('comment');document.selection?(myField.focus(),sel=document.selection.createRange(),sel.text=tag,myField.focus()):insertTag(tag);};function insertTag(tag){myField=document.getElementById('comment');myField.selectionStart||myField.selectionStart=='0'?(startPos=myField.selectionStart,endPos=myField.selectionEnd,cursorPos=startPos,myField.value=myField.value.substring(0,startPos)+tag+myField.value.substring(endPos,myField.value.length),cursorPos+=tag.length,myField.focus(),myField.selectionStart=cursorPos,myField.selectionEnd=cursorPos):(myField.value+=tag,myField.focus());};